<!DOCTYPE html>
<html>
<head>
    <script src="https://aframe.io/releases/1.7.0/aframe.min.js"></script>
    <title>VR Whack-a-Mole Game</title>
</head>
<body>
    <a-scene background="color: #87CEEB" vr-mode-ui="enabled: true">
        <!-- Lighting -->
        <a-light type="ambient" color="#404040"></a-light>
        <a-light type="directional" position="2 4 2" color="#ffffff"></a-light>

        <!-- Ground -->
        <a-plane position="0 0 0" rotation="-90 0 0" width="10" height="10" 
                 color="#228B22" shadow="receive: true"></a-plane>

        <!-- Game holes and moles -->
        <a-cylinder id="hole1" position="-2 0.01 -1" radius="0.4" height="0.02" color="#654321"></a-cylinder>
        <a-box id="mole1" class="mole" position="-2 -0.3 -1" width="0.6" height="0.6" depth="0.6" 
               color="#8B4513" shadow="cast: true"></a-box>

        <a-cylinder id="hole2" position="0 0.01 -2" radius="0.4" height="0.02" color="#654321"></a-cylinder>
        <a-sphere id="mole2" class="mole" position="0 -0.3 -2" radius="0.3" 
                  color="#D2691E" shadow="cast: true"></a-sphere>

        <a-cylinder id="hole3" position="2 0.01 -1" radius="0.4" height="0.02" color="#654321"></a-cylinder>
        <a-box id="mole3" class="mole" position="2 -0.3 -1" width="0.6" height="0.6" depth="0.6" 
               color="#A0522D" shadow="cast: true"></a-box>

        <a-cylinder id="hole4" position="-1 0.01 0" radius="0.4" height="0.02" color="#654321"></a-cylinder>
        <a-sphere id="mole4" class="mole" position="-1 -0.3 0" radius="0.3" 
                  color="#CD853F" shadow="cast: true"></a-sphere>

        <a-cylinder id="hole5" position="1 0.01 0" radius="0.4" height="0.02" color="#654321"></a-cylinder>
        <a-box id="mole5" class="mole" position="1 -0.3 0" width="0.6" height="0.6" depth="0.6" 
               color="#DEB887" shadow="cast: true"></a-box>

        <!-- Score display -->
        <a-text id="score" position="0 3 -3" align="center" color="white" 
                value="Score: 0" width="8"></a-text>

        <!-- Camera with cursor for interaction -->
        <a-camera position="0 1.6 3">
            <a-cursor position="0 0 -1" geometry="primitive: ring; radiusInner: 0.02; radiusOuter: 0.03"
                      material="color: white; shader: flat" 
                      animation__click="property: scale; startEvents: click; from: 0.1 0.1 0.1; to: 1 1 1; dur: 150"
                      raycaster="objects: .mole"></a-cursor>
        </a-camera>
    </a-scene>

    <script>
        // Game variables
        let score = 0;
        let gameActive = true;
        const moles = document.querySelectorAll('.mole');
        const scoreText = document.querySelector('#score');
        let activeMoles = new Set(); // Track which moles are currently up

        // Function to show a random mole
        function showRandomMole() {
            if (!gameActive) return;
            
            // Get moles that aren't currently active
            const availableMoles = Array.from(moles).filter(mole => !activeMoles.has(mole));
            
            if (availableMoles.length === 0) return; // All moles are up
            
            const randomMole = availableMoles[Math.floor(Math.random() * availableMoles.length)];
            activeMoles.add(randomMole);
            
            // Get the original position
            const currentPos = randomMole.getAttribute('position');
            
            // Set proper heights: boxes need to be higher because they're taller
            let upHeight;
            if (randomMole.tagName === 'A-BOX') {
                upHeight = 0.3; // Half the box height (0.6) above ground
            } else {
                upHeight = 0.3; // Sphere radius above ground
            }
            
            const upPos = `${currentPos.x} ${upHeight} ${currentPos.z}`;
            const downPos = `${currentPos.x} -0.3 ${currentPos.z}`;
            
            // Animate mole up
            randomMole.setAttribute('animation', {
                property: 'position',
                to: upPos,
                dur: 500,
                easing: 'easeOutQuad'
            });
            
            // Hide mole after 2.5 seconds if not clicked
            setTimeout(() => {
                if (activeMoles.has(randomMole)) {
                    hideMole(randomMole);
                }
            }, 2500);
        }

        // Function to hide a mole
        function hideMole(mole) {
            const currentPos = mole.getAttribute('position');
            const downPos = `${currentPos.x} -0.3 ${currentPos.z}`;
            
            mole.setAttribute('animation', {
                property: 'position',
                to: downPos,
                dur: 300,
                easing: 'easeInQuad'
            });
            
            activeMoles.delete(mole);
        }

        // Function to handle mole clicks
        function hitMole(event) {
            const mole = event.target;
            
            if (activeMoles.has(mole)) {
                score += 10;
                scoreText.setAttribute('value', `Score: ${score}`);
                
                // Flash effect
                const originalColor = mole.getAttribute('color');
                mole.setAttribute('color', '#FF0000');
                
                setTimeout(() => {
                    mole.setAttribute('color', originalColor);
                }, 200);
                
                // Hide the mole
                hideMole(mole);
            }
        }

        // Initialize game
        function startGame() {
            // Add click listeners to all moles
            moles.forEach(mole => {
                mole.addEventListener('click', hitMole);
            });
            
            console.log("Game started! Moles should start appearing...");
            
            // Start showing moles randomly every 1.5 seconds
            setInterval(() => {
                showRandomMole();
                console.log("Attempting to show a mole...");
            }, 1500);
        }

        // Wait for scene to load, then start game
        document.querySelector('a-scene').addEventListener('loaded', () => {
            console.log("Scene loaded!");
            startGame();
        });
    </script>
</body>
</html>
