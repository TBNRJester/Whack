<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VR Whack-a-Mole Game</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
        }
        
        #intro-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #4CAF50, #45a049);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            color: white;
            text-align: center;
            overflow-y: auto;
            padding: 20px;
            box-sizing: border-box;
        }
        
        #intro-screen h1 {
            font-size: 2.5em;
            margin-bottom: 15px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }
        
        #intro-screen p {
            font-size: 1.1em;
            margin: 8px 0;
            max-width: 600px;
            line-height: 1.4;
        }
        
        #start-button {
            background: #ff6b35;
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 1.5em;
            border-radius: 10px;
            cursor: pointer;
            margin-top: 20px;
            transition: background 0.3s;
        }
        
        #start-button:hover {
            background: #e55a2b;
        }
        
        .hidden {
            display: none !important;
        }

        #game-container {
            width: 100%;
            height: 100vh;
        }
    </style>
</head>
<body>
    <!-- Introduction Screen -->
    <div id="intro-screen">
        <h1>üî® VR Whack-a-Mole üî®</h1>
        <p><strong>Welcome to the ultimate whack-a-mole experience in virtual reality!</strong></p>
        <p>üéØ <strong>How to Play:</strong></p>
        <p>‚Ä¢ Moles (boxes and spheres) will randomly pop up from holes in the ground</p>
        <p>‚Ä¢ Look at a mole and click to whack it!</p>
        <p>‚Ä¢ Each successful hit earns you 10 points</p>
        <p>‚Ä¢ Moles will disappear after 2.5 seconds if you don't hit them</p>
        <p>‚Ä¢ You have 60 seconds to get the highest score possible!</p>
        
        <p>üèÜ <strong>How to Win/Lose:</strong></p>
        <p>‚Ä¢ <strong>EXCELLENT:</strong> Score 200+ points (20+ moles hit)</p>
        <p>‚Ä¢ <strong>GOOD:</strong> Score 100-190 points (10-19 moles hit)</p>
        <p>‚Ä¢ <strong>OKAY:</strong> Score 50-90 points (5-9 moles hit)</p>
        <p>‚Ä¢ <strong>TRY AGAIN:</strong> Score below 50 points (less than 5 moles hit)</p>
        
        <p>ü•Ω <strong>VR Mode:</strong> Click the VR goggles icon in the bottom right to enter VR mode</p>
        <p>üñ±Ô∏è <strong>Desktop Mode:</strong> Use your mouse to look around and click on moles</p>
        
        <button id="start-button">Start Game!</button>
    </div>

    <!-- Game Container (initially hidden) -->
    <div id="game-container" class="hidden"></div>

    <script>
        // Start game when button is clicked
        document.getElementById('start-button').addEventListener('click', function() {
            // Hide intro screen
            document.getElementById('intro-screen').classList.add('hidden');
            
            // Show game container
            const gameContainer = document.getElementById('game-container');
            gameContainer.classList.remove('hidden');
            
            // Load A-Frame script and create scene
            const aframeScript = document.createElement('script');
            aframeScript.src = 'https://aframe.io/releases/1.7.0/aframe.min.js';
            aframeScript.onload = function() {
                createGameScene();
            };
            document.head.appendChild(aframeScript);
        });

        function createGameScene() {
            const gameContainer = document.getElementById('game-container');
            
            // Create the A-Frame scene HTML
            gameContainer.innerHTML = `
                <a-scene background="color: #87CEEB" vr-mode-ui="enabled: true" embedded style="height: 100vh; width: 100vw;">
                    <!-- Lighting -->
                    <a-light type="ambient" color="#404040"></a-light>
                    <a-light type="directional" position="2 4 2" color="#ffffff"></a-light>

                    <!-- Ground -->
                    <a-plane position="0 0 0" rotation="-90 0 0" width="10" height="10" 
                             color="#228B22" shadow="receive: true"></a-plane>

                    <!-- Game holes and moles -->
                    <a-cylinder id="hole1" position="-2 0.01 -1" radius="0.4" height="0.02" color="#654321"></a-cylinder>
                    <a-box id="mole1" class="mole" position="-2 -0.3 -1" width="0.6" height="0.6" depth="0.6" 
                           color="#8B4513" shadow="cast: true"></a-box>

                    <a-cylinder id="hole2" position="0 0.01 -2" radius="0.4" height="0.02" color="#654321"></a-cylinder>
                    <a-sphere id="mole2" class="mole" position="0 -0.3 -2" radius="0.3" 
                              color="#D2691E" shadow="cast: true"></a-sphere>

                    <a-cylinder id="hole3" position="2 0.01 -1" radius="0.4" height="0.02" color="#654321"></a-cylinder>
                    <a-box id="mole3" class="mole" position="2 -0.3 -1" width="0.6" height="0.6" depth="0.6" 
                           color="#A0522D" shadow="cast: true"></a-box>

                    <a-cylinder id="hole4" position="-1 0.01 0" radius="0.4" height="0.02" color="#654321"></a-cylinder>
                    <a-sphere id="mole4" class="mole" position="-1 -0.3 0" radius="0.3" 
                              color="#CD853F" shadow="cast: true"></a-sphere>

                    <a-cylinder id="hole5" position="1 0.01 0" radius="0.4" height="0.02" color="#654321"></a-cylinder>
                    <a-box id="mole5" class="mole" position="1 -0.3 0" width="0.6" height="0.6" depth="0.6" 
                           color="#DEB887" shadow="cast: true"></a-box>

                    <!-- Score and Timer display -->
                    <a-text id="score" position="-1.5 3 -3" align="center" color="white" 
                            value="Score: 0" width="6"></a-text>
                    <a-text id="timer" position="1.5 3 -3" align="center" color="yellow" 
                            value="Time: 60" width="6"></a-text>

                    <!-- Game Over display (initially hidden) -->
                    <a-text id="game-over" position="0 3 -3" align="center" color="red" 
                            value="" width="12" visible="false"></a-text>

                    <!-- Instructions in VR -->
                    <a-text position="0 2.5 -3" align="center" color="white" 
                            value="Look at moles and click to whack them!" width="6"></a-text>

                    <!-- Camera with cursor for interaction -->
                    <a-camera position="0 1.6 3">
                        <a-cursor position="0 0 -1" geometry="primitive: ring; radiusInner: 0.02; radiusOuter: 0.03"
                                  material="color: white; shader: flat" 
                                  animation__click="property: scale; startEvents: click; from: 0.1 0.1 0.1; to: 1 1 1; dur: 150"
                                  raycaster="objects: .mole"></a-cursor>
                    </a-camera>
                </a-scene>
            `;

            // Wait a moment for the scene to initialize, then start the game
            setTimeout(initializeGame, 1000);
        }

        function initializeGame() {
            // Game variables
            let score = 0;
            let timeLeft = 60;
            let gameActive = true;
            const scoreText = document.querySelector('#score');
            const timerText = document.querySelector('#timer');
            const gameOverText = document.querySelector('#game-over');
            let activeMoles = new Set();
            let gameInterval;
            let timerInterval;

            // Function to determine performance level
            function getPerformanceLevel(finalScore) {
                if (finalScore >= 200) {
                    return { level: "EXCELLENT", color: "green", message: "Amazing! You're a mole-whacking master!" };
                } else if (finalScore >= 100) {
                    return { level: "GOOD", color: "blue", message: "Great job! You've got good reflexes!" };
                } else if (finalScore >= 50) {
                    return { level: "OKAY", color: "orange", message: "Not bad! Keep practicing to improve!" };
                } else {
                    return { level: "TRY AGAIN", color: "red", message: "Don't give up! Practice makes perfect!" };
                }
            }

            // Start the countdown timer
            timerInterval = setInterval(() => {
                timeLeft--;
                timerText.setAttribute('value', `Time: ${timeLeft}`);
                
                // Change timer color when time is running low
                if (timeLeft <= 10) {
                    timerText.setAttribute('color', 'red');
                } else if (timeLeft <= 20) {
                    timerText.setAttribute('color', 'orange');
                }
                
                // End game when time runs out
                if (timeLeft <= 0) {
                    endGame();
                }
            }, 1000);

            // Function to end the game
            function endGame() {
                gameActive = false;
                clearInterval(gameInterval);
                clearInterval(timerInterval);
                
                // Hide all active moles
                activeMoles.forEach(mole => {
                    hideMole(mole);
                });
                
                // Hide score and timer text
                scoreText.setAttribute('visible', 'false');
                timerText.setAttribute('visible', 'false');
                
                // Hide instructions to make room for game over text
                const instructions = document.querySelector('a-text[value="Look at moles and click to whack them!"]');
                if (instructions) {
                    instructions.setAttribute('visible', 'false');
                }
                
                // Determine performance and show results
                const performance = getPerformanceLevel(score);
                const molesHit = score / 10;
                
                gameOverText.setAttribute('value', 
                    `GAME OVER!\n\nFinal Score: ${score}\nMoles Hit: ${molesHit}\n\nRating: ${performance.level}\n${performance.message}\n\nRefresh to play again`
                );
                gameOverText.setAttribute('color', performance.color);
                gameOverText.setAttribute('visible', 'true');
            }

            // Function to show a random mole
            function showRandomMole() {
                if (!gameActive) return;
                
                const moles = document.querySelectorAll('.mole');
                const availableMoles = Array.from(moles).filter(mole => !activeMoles.has(mole));
                
                if (availableMoles.length === 0) return;
                
                const randomMole = availableMoles[Math.floor(Math.random() * availableMoles.length)];
                activeMoles.add(randomMole);
                
                const currentPos = randomMole.getAttribute('position');
                const upPos = `${currentPos.x} 0.3 ${currentPos.z}`;
                
                randomMole.setAttribute('animation', {
                    property: 'position',
                    to: upPos,
                    dur: 500,
                    easing: 'easeOutQuad'
                });
                
                setTimeout(() => {
                    if (activeMoles.has(randomMole)) {
                        hideMole(randomMole);
                    }
                }, 2500);
            }

            function hideMole(mole) {
                const currentPos = mole.getAttribute('position');
                const downPos = `${currentPos.x} -0.3 ${currentPos.z}`;
                
                mole.setAttribute('animation', {
                    property: 'position',
                    to: downPos,
                    dur: 300,
                    easing: 'easeInQuad'
                });
                
                activeMoles.delete(mole);
            }

            function hitMole(event) {
                const mole = event.target;
                
                if (activeMoles.has(mole) && gameActive) {
                    score += 10;
                    scoreText.setAttribute('value', `Score: ${score}`);
                    
                    const originalColor = mole.getAttribute('color');
                    mole.setAttribute('color', '#FF0000');
                    
                    setTimeout(() => {
                        mole.setAttribute('color', originalColor);
                    }, 200);
                    
                    hideMole(mole);
                }
            }

            // Set up mole click events
            const moles = document.querySelectorAll('.mole');
            moles.forEach(mole => {
                mole.addEventListener('click', hitMole);
            });
            
            // Start the game
            gameInterval = setInterval(showRandomMole, 1500);
            console.log("Whack-a-Mole game started with performance ratings!");
        }
    </script>
</body>
</html>
